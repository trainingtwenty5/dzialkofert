<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Działkofert - Dodaj darmowe ogłoszenie</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  
    <!-- Favicon dla przeglądarek -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png">
  <link rel="icon" type="image/png" sizes="64x64" href="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png">

  <!-- Ikona dla Apple (po zapisaniu strony na ekranie głównym iPhone/iPad) -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png">

  <!-- Ikona dla Androida (progressive web app / home screen) -->
  <link rel="icon" type="image/png" sizes="192x192" href="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png">
  <link rel="icon" type="image/png" sizes="512x512" href="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png">

	
  <style>
    :root {
      --primary: #1e6fba;
      --primary-dark: #155d9d;
      --secondary: #2c8ac9;
      --accent: #3ba3e3;
      --dark: #1e293b;
      --darker: #0f172a;
      --light: #f0f8ff;
      --gray: #7b9cba;
      --success: #2e94cc;
      
      --gradient-primary: linear-gradient(135deg, #1e6fba, #2c8ac9);
      --gradient-accent: linear-gradient(135deg, #3ba3e3, #2c8ac9);
      --gradient-card: linear-gradient(135deg, #ffffff, #e6f2ff);
      
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      --radius: 10px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      color: var(--dark);
      background-color: var(--light);
      line-height: 1.5;
      overflow-x: hidden;
      font-size: 0.95rem;
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 0.875rem;
    }

    h1 {
      font-size: 2.5rem;
    }

    h2 {
      font-size: 2rem;
    }

    h3 {
      font-size: 1.5rem;
    }

    p {
      margin-bottom: 1.25rem;
      font-size: 0.95rem;
    }

    a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition);
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 1.25rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      font-weight: 600;
      transition: var(--transition);
      border: none;
      cursor: pointer;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .btn-secondary:hover {
      background: var(--primary);
      color: white;
    }

    .btn-accent {
      background: var(--gradient-accent);
      color: white;
    }

    .btn-outline-primary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .btn-outline-primary:hover {
      background: var(--primary);
      color: white;
    }

    .section {
      padding: 3.5rem 0;
    }

    .section-title {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .section-title h2 {
      position: relative;
      display: inline-block;
      margin-bottom: 1.25rem;
    }

    .section-title h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }

    /* Top Navbar */
    .top-navbar {
      background: #fff;
      color: var(--dark);
      padding: 0.4rem 0;
      font-size: 0.85rem;
      border-bottom: 1px solid #eee;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1100;
    }
    
    .top-navbar-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Header */
    header {
      position: fixed;
      top: 40px;
      left: 0;
      width: 100%;
      z-index: 1000;
      background: #fff;
      box-shadow: var(--shadow-sm);
      padding: 0.875rem 0;
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--darker);
    }

    .logo img {
      height: 32px;
      width: auto;
    }

    .nav-menu {
      display: flex;
      gap: 1.5rem;
    }

    .nav-link {
      font-weight: 500;
      color: var(--dark);
      position: relative;
      font-size: 0.95rem;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--gradient-primary);
      transition: var(--transition);
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: var(--dark);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1100;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: var(--radius);
      width: 90%;
      max-width: 400px;
      box-shadow: var(--shadow-lg);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--dark);
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-size: 0.95rem;
    }

    .form-footer {
      margin-top: 1.5rem;
      text-align: center;
      font-size: 0.9rem;
    }

    /* User Dashboard */
    .user-dashboard {
      display: none;
      margin-top: 120px;
      margin-bottom: 20px;
      padding: 2rem;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
    }

    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .offers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .offer-card p {
      margin: 0.25rem 0;
      font-size: 0.9rem;
      color: #555;
    }

    .offer-card h5 {
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
      color: var(--primary, #1e6fba);
    }

    .offer-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 0.5rem;
    }

    .offer-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
      padding: 1.25rem;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin-bottom: 1.25rem;
    }

    .offer-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    .offer-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #222;
    }

    .offer-details {
      font-size: 0.85rem;
      color: #666;
      line-height: 1.4;
      margin-bottom: 0.75rem;
    }

    .offer-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-sm {
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      border-radius: 6px;
    }

    /* Hero Section */
    .hero {
      padding: 10rem 0 4rem;
      background: linear-gradient(135deg, rgba(30, 111, 186, 0.05) 0%, rgba(44, 138, 201, 0.05) 100%);
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: -80px;
      right: -80px;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: var(--gradient-primary);
      opacity: 0.1;
      filter: blur(60px);
    }

    .hero-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2.5rem;
      align-items: center;
    }

    .hero-text h1 {
      font-size: 2.5rem;
      margin-bottom: 1.25rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero-text p {
      font-size: 1.1rem;
      color: var(--gray);
      margin-bottom: 2rem;
    }

    .hero-buttons {
      display: flex;
      gap: 0.875rem;
      flex-wrap: wrap;
    }

    .hero-image {
      position: relative;
    }

    .hero-image img {
      width: 100%;
      max-width: 450px;
      height: auto;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      transform: perspective(800px) rotateY(-10deg);
      transition: var(--transition);
    }

    .hero-image img:hover {
      transform: perspective(800px) rotateY(0);
    }

    /* Features */
    .features {
      background: white;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.75rem;
    }

    .feature-card {
      background: var(--gradient-card);
      padding: 1.75rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      text-align: center;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .feature-icon {
      width: 55px;
      height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.25rem;
      border-radius: 50%;
      background: var(--gradient-primary);
      color: white;
      font-size: 1.5rem;
    }

    /* Course Info */
    .course-info {
      background: linear-gradient(135deg, rgba(30, 111, 186, 0.05) 0%, rgba(44, 138, 201, 0.05) 100%);
    }

    .info-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3.5rem;
      align-items: center;
    }

    .info-image {
      position: relative;
    }

    .info-image img {
      width: 100%;
      max-width: 450px;
      height: auto;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
    }

    .info-badge {
      position: absolute;
      top: -12px;
      right: -12px;
      background: var(--gradient-primary);
      color: white;
      padding: 0.625rem 1.25rem;
      border-radius: 25px;
      font-weight: 600;
      box-shadow: var(--shadow-md);
      font-size: 0.85rem;
    }

    .info-content h2 {
      margin-bottom: 1.25rem;
    }

    .info-list {
      list-style: none;
      margin-bottom: 1.75rem;
    }

    .info-list li {
      margin-bottom: 0.625rem;
      display: flex;
      align-items: center;
      gap: 0.625rem;
      font-size: 0.95rem;
    }

    .info-list li::before {
      content: '✓';
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: var(--success);
      color: white;
      border-radius: 50%;
      font-size: 0.7rem;
    }

    /* Instructor */
    .instructor {
      background: white;
    }

    .instructor-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 3.5rem;
      align-items: center;
    }

    .instructor-image {
      position: relative;
    }

    .instructor-image img {
      width: 100%;
      max-width: 300px;
      height: auto;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
    }

    .instructor-badge {
      position: absolute;
      bottom: -12px;
      left: -12px;
      background: var(--gradient-primary);
      color: white;
      padding: 0.625rem 1.25rem;
      border-radius: 25px;
      font-weight: 600;
      box-shadow: var(--shadow-md);
      font-size: 0.85rem;
    }

    .instructor-bio h2 {
      margin-bottom: 1.25rem;
    }

    .social-links {
      display: flex;
      gap: 0.875rem;
      margin-top: 1.25rem;
    }

    .social-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--light);
      color: var(--dark);
      transition: var(--transition);
    }

    .social-link:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-3px);
    }

    /* FAQ */
    .faq {
      background: linear-gradient(135deg, rgba(30, 111, 186, 0.05) 0%, rgba(44, 138, 201, 0.05) 100%);
    }

    .faq-container {
      max-width: 750px;
      margin: 0 auto;
    }

    .faq-item {
      margin-bottom: 1.25rem;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      background: white;
    }

    .faq-question {
      padding: 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 0.95rem;
    }

    .faq-question:hover {
      color: var(--primary);
    }

    .faq-question i {
      transition: var(--transition);
    }

    .faq-answer {
      padding: 0 1.25rem;
      max-height: 0;
      overflow: hidden;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .faq-item.active .faq-question i {
      transform: rotate(180deg);
    }

    .faq-item.active .faq-answer {
      padding: 0 1.25rem 1.25rem;
      max-height: 500px;
    }

    /* CTA */
    .cta {
      background: var(--gradient-primary);
      color: white;
      text-align: center;
      padding: 5rem 0;
      position: relative;
      overflow: hidden;
    }

    .cta::before {
      content: '';
      position: absolute;
      top: -80px;
      left: -80px;
      width: 250px;
      height: 250px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
    }

    .cta::after {
      content: '';
      position: absolute;
      bottom: -80px;
      right: -80px;
      width: 250px;
      height: 250px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
    }

    .cta h2 {
      margin-bottom: 1.25rem;
    }

    .cta p {
      max-width: 550px;
      margin: 0 auto 2rem;
      opacity: 0.9;
    }

    /* Footer */
    footer {
      background: var(--darker);
      color: white;
      padding: 4rem 0 1.75rem;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 2.5rem;
      margin-bottom: 2.5rem;
    }

    .footer-logo {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      margin-bottom: 1.25rem;
      font-weight: 700;
      font-size: 1.25rem;
    }

    .footer-logo img {
      height: 32px;
      width: auto;
    }

    .footer-about p {
      opacity: 0.7;
      margin-bottom: 1.25rem;
      font-size: 0.9rem;
    }

    .footer-links h3,
    .footer-contact h3 {
      margin-bottom: 1.25rem;
      position: relative;
      display: inline-block;
      font-size: 1.1rem;
    }

    .footer-links h3::after,
    .footer-contact h3::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 0;
      width: 25px;
      height: 2px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }

    .footer-links ul {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 0.625rem;
    }

    .footer-links a {
      color: var(--gray);
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .footer-links a:hover {
      color: white;
      padding-left: 5px;
    }

    .footer-contact p {
      margin-bottom: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.625rem;
      opacity: 0.7;
      font-size: 0.9rem;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      opacity: 0.7;
      font-size: 0.85rem;
    }

    /* Responsive */
    @media (max-width: 992px) {
      h1 {
        font-size: 2.25rem;
      }
      
      h2 {
        font-size: 1.75rem;
      }
      
      .hero-content,
      .info-container,
      .instructor-container {
        grid-template-columns: 1fr;
        gap: 2.5rem;
      }
      
      .hero-text {
        order: 2;
        text-align: center;
      }
      
      .hero-image {
        order: 1;
      }
    }

    @media (max-width: 768px) {
      .nav-menu {
        position: fixed;
        top: 110px;
        left: 0;
        width: 100%;
        flex-direction: column;
        background: white;
        padding: 1.75rem;
        box-shadow: var(--shadow-md);
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: var(--transition);
      }
      
      .nav-menu.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }
      
      .mobile-menu-btn {
        display: block;
      }
      
      .hero {
        padding: 8rem 0 2.5rem;
      }
      
      .hero-text h1 {
        font-size: 2rem;
      }
      
      .hero-buttons {
        justify-content: center;
      }
      
      .top-navbar-container {
        justify-content: center;
      }
    }

    @media (max-width: 576px) {
      .section {
        padding: 2.5rem 0;
      }
      
      .hero-text h1 {
        font-size: 1.75rem;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .hero-buttons {
        flex-direction: column;
      }
      
      header {
        top: 70px;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 1s ease forwards;
    }

    .delay-1 {
      animation-delay: 0.2s;
    }

    .delay-2 {
      animation-delay: 0.4s;
    }

    .delay-3 {
      animation-delay: 0.6s;
    }

    /* Social login buttons */
    .social-login {
      margin-top: 1.5rem;
      text-align: center;
    }
    
    .social-login .btn {
      margin-bottom: 0.75rem;
      width: 100%;
      justify-content: center;
    }
    
    .btn-google {
      background: #DB4437;
      color: white;
      border: none;
    }
    
    .btn-google:hover {
      background: #c23325;
      color: white;
    }
    
    .btn-facebook {
      background: #4267B2;
      color: white;
      border: none;
    }
    
    .btn-facebook:hover {
      background: #365899;
      color: white;
    }
    
    .domain-warning {
      display: none;
      background: #ffebee;
      color: #c62828;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 14px;
    }
	
    /* Top Navbar (komputer) */
    .top-navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      width: 100%;
      background: #fff;
      z-index: 1200;
      padding: 0.5rem 1rem;
      border-bottom: 1px solid #eee;
    }

    .contact-info {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-size: 0.9rem;
    }

    .auth-buttons,
    .user-menu {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .top-navbar .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
    }

    /* Przycisk Dodaj ofertę */
    .desktop-add-offer,
    .mobile-add-offer {
      display: inline-flex;
      align-items: center;
      padding: 0.4rem 0.8rem;
      border-radius: 5px;
      background: linear-gradient(90deg, #007bff, #0056b3);
      color: white;
      font-weight: 500;
      font-size: 0.85rem;
      text-decoration: none;
      transition: 0.3s;
    }

    .desktop-add-offer:hover,
    .mobile-add-offer:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 40px; /* pod top-navbar na desktopie */
      width: 100%;
      z-index: 1100;
      background: #fff;
      padding: 0.5rem 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    header .logo img {
      height: 70px;
      margin-right: 0.5rem;
    }

    /* Desktopowe menu */
    .desktop-nav {
      display: flex;
      gap: 1.5rem;
    }

    .desktop-nav .nav-link {
      text-decoration: none;
      color: #333;
      font-weight: 500;
    }

    /* Menu i przyciski mobilne */
    .nav-menu {
      position: fixed;
      top: 60px;
      left: 0;
      width: 100%;
      flex-direction: column;
      background: white;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: 0.3s;
      z-index: 1000;
    }

    .nav-menu.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .nav-menu .nav-link {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #333;
      text-decoration: none;
    }

    .mobile-auth {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
      border-top: 1px solid #eee;
      padding-top: 1.5rem;
    }

    .mobile-menu-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      display: none;
    }

    /* Responsywność */
    @media (max-width: 768px) {
      .top-navbar,
      .desktop-nav,
      .desktop-add-offer {
        display: none !important;
      }

      header {
        top: 0; /* header przy samej górze telefonu */
      }

      .mobile-add-offer,
      .mobile-menu-btn {
        display: inline-flex;
      }
    }

    @media (min-width: 769px) {
      .nav-menu,
      .mobile-add-offer,
      .mobile-menu-btn,
      .mobile-auth {
        display: none !important;
      }
    }

    /* GŁÓWNY UKŁAD STRONY - STATYCZNA MAPA PO LEWEJ, PRZEWIJANA ZAWARTOŚĆ PO PRAWEJ */
    .main-layout {
      display: flex;
      height: calc(100vh - 120px);
      margin-top: 120px;
      position: relative;
    }

    /* Lewa strona - statyczna mapa */
    .map-container {
      position: fixed;
      left: 0;
      top: 120px;
      width: 70%;
      height: calc(100vh - 120px);
      z-index: 1;
    }

    #map {
      width: 100%;
      height: 100%;
      border-radius: 0;
    }

    /* Prawa strona - przewijana zawartość */
    .content-container {
      margin-left: 70%;
      width: 30%;
      padding: 20px;
      overflow-y: auto;
      background: #f8f9fa;
      height: calc(100vh - 120px);
    }

    /* Sekcje ofert */
    .offers-section {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
	  height: 800px;
    }

    .offers-section .section-title {
      margin-bottom: 1rem;
    }

    .offers-section .section-title h2 {
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
    }

    /* Kontenery list ofert - przewijane */
    .offers-list, .offers-grid {
      max-height: 800px;
      overflow-y: auto;
    }

    /* User dashboard dostosowanie */
    .user-dashboard {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
    }

    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .user-header h2 {
      margin: 0;
      font-size: 1.5rem;
    }

    /* Responsywność - na mniejszych ekranach */
    @media (max-width: 992px) {
      .main-layout {
        flex-direction: column;
        height: auto;
        margin-top: 110px;
      }
      
      .map-container {
        position: relative;
        width: 100%;
        height: 50vh;
        top: 0;
      }
      
      .content-container {
        margin-left: 0;
        width: 100%;
        height: auto;
        padding: 10px;
      }
    }

    /* Bardzo małe ekrany */
    @media (max-width: 576px) {
      .main-layout {
        margin-top: 100px;
      }
      
      .map-container {
        height: 40vh;
      }
      
      .offers-section {
        padding: 15px;
      }
      
      .user-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .user-header h2 {
        font-size: 1.3rem;
      }
    }

    /* Styl paska przewijania */
    .offers-list::-webkit-scrollbar,
    .offers-grid::-webkit-scrollbar {
      width: 6px;
    }

    .offers-list::-webkit-scrollbar-track,
    .offers-grid::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .offers-list::-webkit-scrollbar-thumb,
    .offers-grid::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }

    .offers-list::-webkit-scrollbar-thumb:hover,
    .offers-grid::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }

    /* Styl dla modala edycji */
    #editModal .modal-content {
      max-width: 500px;
    }

    #editModal .form-group {
      margin-bottom: 1rem;
    }

    #editModal .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }

    #editModal .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-size: 0.95rem;
      transition: border-color 0.3s;
    }

    #editModal .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(30, 111, 186, 0.1);
    }
	
    /* Napraw problemy z pozycjonowaniem Leaflet */
    .leaflet-container {
      height: 100%;
      width: 100%;
      touch-action: auto !important;
    }
	
    /* Ukryj powiadomienie o CTRL w Google Maps */
    .gm-style-moc {
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
    }

    /* Ukryj wszystkie elementy, które mogą zawierać tekst o CTRL */
    .gm-style div, 
    .gm-style span {
      font-size: 12px !important;
    }

    /* Ukryj powiadomienia o CTRL */
    .gm-style div[style*="CTRL"], 
    .gm-style div[style*="Ctrl"] {
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
    }
	
	
	/* STOPKA - WIDOCZNA I POPRAWNIE UMIESZCZONA */
footer {
  background: var(--darker);
  color: white;
  padding: 3rem 0 1.5rem;
  width: 100%;
  position: relative;
  z-index: 1000;
  margin-top: auto; /* Push footer to bottom */
  clear: both;
}

/* Kontener stopki - wyśrodkowanie */
.footer-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 1.25rem;
}

/* Logo w stopce */
.footer-logo {
  display: flex;
  align-items: center;
  gap: 0.625rem;
  margin-bottom: 1.25rem;
  font-weight: 700;
  font-size: 1.25rem;
  color: white !important;
  text-decoration: none;
}

.footer-logo img {
  height: 32px;
  width: auto;
  filter: brightness(0) invert(1);
}

/* Sekcje stopki */
.footer-about p {
  opacity: 0.8;
  margin-bottom: 1.25rem;
  font-size: 0.9rem;
  line-height: 1.6;
}

.footer-links h3,
.footer-contact h3 {
  margin-bottom: 1.25rem;
  position: relative;
  display: inline-block;
  font-size: 1.1rem;
  color: white;
}

.footer-links h3::after,
.footer-contact h3::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 0;
  width: 25px;
  height: 2px;
  background: var(--gradient-primary);
  border-radius: 2px;
}

.footer-links ul {
  list-style: none;
  padding: 0;
}

.footer-links li {
  margin-bottom: 0.625rem;
}

.footer-links a {
  color: var(--gray);
  transition: var(--transition);
  font-size: 0.9rem;
  text-decoration: none;
}

.footer-links a:hover {
  color: white;
  padding-left: 5px;
}

.footer-contact p {
  margin-bottom: 0.875rem;
  display: flex;
  align-items: center;
  gap: 0.625rem;
  opacity: 0.8;
  font-size: 0.9rem;
}

.footer-bottom {
  text-align: center;
  padding-top: 1.75rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  opacity: 0.7;
  font-size: 0.85rem;
  max-width: 1100px;
  margin: 0 auto;
  padding-left: 1.25rem;
  padding-right: 1.25rem;
}

/* RESPONSYWNOŚĆ */
@media (max-width: 992px) {
  .main-layout-wrapper {
    flex-direction: column;
    margin-top: 100px;
  }
  
  .main-layout {
    flex-direction: column;
    height: auto;
  }
  
  .map-container {
    position: relative;
    width: 100% !important;
    height: 50vh;
    top: 0;
  }
  
  .content-container {
    margin-left: 0 !important;
    width: 100% !important;
    height: auto;
    min-height: auto;
  }
  
  footer {
    position: relative;
    z-index: 1000;
    margin-top: 0;
  }
  
  .footer-container {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .footer-links h3::after,
  .footer-contact h3::after {
    left: 50%;
    transform: translateX(-50%);
  }
}

@media (max-width: 576px) {
  .main-layout-wrapper {
    margin-top: 80px;
  }
  
  .map-container {
    height: 40vh;
  }
  
  footer {
    padding: 2rem 0 1rem;
  }
  
  .footer-container {
    gap: 1.5rem;
  }
}
	
/* === NADPISANIA DLA PRAWEJ KOLUMNY I SEKCJI OFERT === */
.content-container {
  position: relative;
  z-index: 2;              /* zawartość zawsze nad mapą */
  background: #f8f9fa;
}

.offers-section {
  height: auto !important; /* nie wymuszaj stałej wysokości */
  margin-bottom: 24px;     /* oddech przed "Moje Oferty" */
}

.offers-list,
.offers-grid {
  max-height: none !important;  /* pozwól rosnąć, nie ucinać */
  overflow: visible !important; /* bez wewnętrznych scrolli */
}

/* "Moje Oferty" – bez nakładania i z marginesem */
#userDashboard {
  margin-top: 16px;
  scroll-margin-top: 140px; /* żeby scroll do sekcji nie chował się pod fixed headerem */
}

/* na mniejszych ekranach prawa kolumna i tak jest pod mapą – zostaw auto */
@media (max-width: 992px) {
  .offers-list, .offers-grid {
    max-height: none !important;
    overflow: visible !important;
  }
}
	
/* MOBILE: pokaż sekcję logowania w rozwijanym menu */
@media (max-width: 768px) {
  .mobile-auth{
    display: none;                /* domyślnie schowaj… */
    flex-direction: column;
    gap: 1rem;
    margin-top: 1.5rem;
    border-top: 1px solid #eee;
    padding-top: 1.5rem;
  }
  .nav-menu.active .mobile-auth{
    display: flex;                /* …ale pokaż gdy menu jest rozwinięte */
  }
  .nav-menu{ z-index: 1200; }     /* na wszelki wypadek ponad mapą/headerem */
}
	
/* === SIZE & DENSITY OVERRIDES (jak na stronie głównej) === */
html { font-size: 15px; }
body { font-size: 0.9rem; }

.top-navbar { padding: 0.3rem 0.75rem; font-size: 0.8rem; }
header { padding: 0.4rem 0.75rem; top: 40px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.logo img { height: 42px; }
.logo span { font-size: 1rem; }
.nav-link { font-size: 0.9rem; }

.section { padding: 2rem 0; }
.hero { padding: 6rem 0 2.5rem; }
.hero-text h1 { font-size: 1.9rem; }
.hero-text p { font-size: 1rem; margin-bottom: 1.25rem; }
.hero-buttons { gap: 0.5rem; }

.btn { padding: 0.55rem 1rem; font-size: 0.85rem; border-radius: 8px; gap: 0.4rem; }
.btn-sm { padding: 0.3rem 0.6rem; font-size: 0.75rem; border-radius: 6px; }

.modal-content { padding: 1.1rem; max-width: 360px; }
.modal-header { margin-bottom: 0.9rem; }
.modal-header h3 { font-size: 1.1rem; }
.form-group { margin-bottom: 0.8rem; }
.form-group label { font-size: 0.85rem; margin-bottom: 0.4rem; }
.form-group input { padding: 0.55rem 0.75rem; font-size: 0.9rem; border-radius: 8px; }
.form-footer { margin-top: 1rem; font-size: 0.85rem; }

.social-login { margin-top: 0.9rem; }
.social-login .btn { margin-bottom: 0.5rem; }

.offers-grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
.offer-card { padding: 1rem; }
.offer-title { font-size: 0.95rem; }
.offer-card h5 { font-size: 1.05rem; }
.offer-details { font-size: 0.82rem; }

.feature-card { padding: 1.2rem; }
.feature-icon { width: 44px; height: 44px; font-size: 1.1rem; }
.info-badge, .instructor-badge { padding: 0.45rem 0.9rem; font-size: 0.8rem; }
.cta { padding: 3.5rem 0; }

footer { padding: 2.5rem 0 1.25rem; }
.footer-container { gap: 1.5rem; }

.desktop-add-offer, .mobile-add-offer {
  padding: 0.35rem 0.7rem; font-size: 0.8rem; border-radius: 6px;
}

.domain-warning { font-size: 0.85rem; padding: 8px; }

@media (max-width: 1024px) {
  html { font-size: 14px; }
  .logo img { height: 36px; }
  .nav-link { font-size: 0.85rem; }
  .modal-content { max-width: 340px; }
}
@media (max-width: 768px) {
  html { font-size: 13px; }
  .hero { padding: 5.5rem 0 2rem; }
  .hero-text h1 { font-size: 1.6rem; }
  header { top: 0; }
  .nav-menu { top: 52px; padding: 1.1rem; }
  .nav-menu .nav-link { font-size: 0.95rem; margin-bottom: 0.7rem; }
  .mobile-add-offer { font-size: 0.85rem; padding: 0.35rem 0.7rem; }
}
@media (max-width: 480px) {
  html { font-size: 12px; }
  .modal-content { max-width: 320px; padding: 1rem; }
  .btn { width: 100%; }
  .feature-card { padding: 1rem; }
  .hero-text h1 { font-size: 1.45rem; }
}
	
	
  </style>
</head>
<body>
  <!-- Top Navbar - tylko na komputerze -->
  <div class="top-navbar">
    <div class="contact-info">
      <i class="fas fa-clock"></i> Poniedziałek - Piątek 9:00 - 18:00
      <span><i class="fas fa-phone"></i> +48 505 849 404</span>
    </div>

    <div class="auth-buttons" id="authButtons">
      <button class="btn btn-outline-primary btn-sm me-2" id="loginBtn">
        <i class="fas fa-sign-in-alt me-1"></i> Zaloguj się
      </button>
      <button class="btn btn-primary btn-sm" id="registerBtn">
        <i class="fas fa-user-plus me-1"></i> Zarejestruj się
      </button>
    </div>

    <div class="user-menu" id="userMenu" style="display: none;">
      <button class="btn btn-outline-primary btn-sm me-2" id="accountBtn">
        <i class="fas fa-user me-1"></i> Moje konto
      </button>

      <button class="btn btn-secondary btn-sm ms-2" id="logoutBtn">
        <i class="fas fa-sign-out-alt me-1"></i> Wyloguj
      </button>
    </div>
  </div>

  <!-- Header - telefon -->
  <header>
    <a href="index.html" class="logo">
      <img src="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png" alt="Działkofert">
      <span>Działkofert</span>
    </a>

    <nav class="desktop-nav">
      <a href="index.html" class="nav-link">Strona główna</a>
      <a href="oferty.html" class="nav-link">Oferty</a>
      <a href="#contact" class="nav-link">Kontakt</a>
    </nav>

    <!-- Przycisk Dodaj ofertę -->
    <a href="dodaj.html" class="desktop-add-offer">
      <i class="fas fa-plus"></i> Dodaj ofertę
    </a>

    <!-- Przycisk Dodaj ofertę -->
    <a href="dodaj.html" class="mobile-add-offer">
      <i class="fas fa-plus"></i> Dodaj ofertę
    </a>

    <button class="mobile-menu-btn">
      <i class="fas fa-bars"></i>
    </button>

    <nav class="nav-menu">
      <a href="index.html" class="nav-link">Strona główna</a>
      <a href="oferty.html" class="nav-link">Oferty</a>
      <a href="dodaj.html" class="nav-link">Dodaj ofertę</a>
      <a href="#contact" class="nav-link">Kontakt</a>

      <div class="mobile-auth">
        <a href="#" id="loginLink" class="nav-link">Zaloguj się</a>
        <a href="#" id="registerLink" class="nav-link">Zarejestruj się</a>
      </div>
    </nav>
  </header>

  <!-- ===== GŁÓWNY UKŁAD Z MAPĄ I ZAWARTOŚCIĄ ===== -->
  <div class="main-layout">
    <!-- Lewa strona - statyczna mapa -->
    <div class="map-container">
      <div id="map"></div>
    </div>
    
    <!-- Prawa strona - przewijana zawartość -->
    <div class="content-container">
      <!-- Panel z ofertami publicznymi -->
      <div class="offers-section">
        <div class="section-title">
          <h2>Oferty działek</h2>
        </div>
        <div class="offers-list" id="offersList"></div>
      </div>
      
      <!-- Panel z Twoimi ofertami -->
	  
	  
    
        <div class="section-title">
          <h2>Moje Oferty</h2>
        </div>
        <div  id="userDashboard">
     
          <div class="offers-grid" id="userOffers"></div>
        </div>
     </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Zaloguj się</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <input type="email" id="loginEmail" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">Hasło</label>
          <input type="password" id="loginPassword" required>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Zaloguj się</button>
      </form>
	  
	  <div class="social-login">
  <button type="button" class="btn btn-google" id="googleLoginBtnLogin">
    <i class="fab fa-google"></i> Kontynuuj z Google
  </button>
</div>
	  
      <div class="form-footer">
        <p>Nie masz konta? <a href="#" id="switchToRegister">Zarejestruj się</a></p>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Utwórz konto</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="registerForm">
        <div class="form-group">
          <label for="registerName">Imię i nazwisko</label>
          <input type="text" id="registerName" required>
        </div>
        <div class="form-group">
          <label for="registerEmail">Email</label>
          <input type="email" id="registerEmail" required>
        </div>
        <div class="form-group">
          <label for="registerPassword">Hasło</label>
          <input type="password" id="registerPassword" required>
        </div>
        <div class="form-group">
          <label for="registerConfirmPassword">Potwierdź hasło</label>
          <input type="password" id="registerConfirmPassword" required>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Zarejestruj się</button>
      </form>
	  
      <div class="social-login mt-3 text-center">
        <button type="button" class="btn btn-google w-100 mb-2" id="googleLoginBtn">
          <i class="fab fa-google me-1"></i> Zaloguj przez Google
        </button>

      </div>
      
      <div class="domain-warning" id="domainWarning">
        <i class="fas fa-exclamation-triangle"></i> 
        Uwaga: Logowanie przez Facebook może nie działać na tej domenie. 
        Aby rozwiązać ten problem, dodaj swoją domenę w ustawieniach Firebase.
      </div>
	  
      <div class="form-footer">
        <p>Masz już konto? <a href="#" id="switchToLogin">Zaloguj się</a></p>
      </div>
    </div>
  </div>

  <!-- Modal edycji -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edytuj ofertę</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="editForm">
        <input type="hidden" id="editOfferId">
        <input type="hidden" id="editPlotIndex">
        
        <div class="form-group">
          <label for="editPlotId">Identyfikator działki</label>
          <input type="text" id="editPlotId" required>
        </div>
        
        <div class="form-group">
          <label for="editPrice">Cena całkowita (zł)</label>
          <input type="number" id="editPrice" required>
        </div>
        
        <div class="form-group">
          <label for="editPhone">Telefon kontaktowy</label>
          <input type="tel" id="editPhone" required>
        </div>
        
        <div class="form-group">
          <label for="editCity">Miejscowość</label>
          <input type="text" id="editCity" required>
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%;">Zaktualizuj ofertę</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer id="contact">
    <div class="container">	
      <div class="footer-container">
        <div class="footer-about">
          <a style="color:white" href="index.html" class="footer-logo">
            <img src="https://storage.waw.cloud.ovh.net/v1/AUTH_024f82ed62da4186825a5b526cd1a61e/FishFounder/Dzialkofert_logo.png" alt="Działkofert">
            <span>Działkofert</span>
          </a>
          <p>Bezpłatne ogłoszenia nieruchomości. Szybka sprzedaż działek bez zbędnych kosztów i formalności.</p>
        </div>
        
        <div class="footer-links">
          <h3>Przydatne linki</h3>
          <ul>
            <li><a href="#home">Strona główna</a></li>
            <li><a href="#features">Dlaczego my</a></li>
            <li><a href="#how-it-works">Jak to działa</a></li>
            <li><a href="#faq">FAQ</a></li>
          </ul>
        </div>
        
        <div class="footer-contact">
          <h3>Kontakt</h3>
          <p><i class="fas fa-envelope"></i> info@dzialkiekspres.pl</p>
          <p><i class="fas fa-phone"></i> +48 123 456 789</p>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>© 2025 Działkofert. Wszelkie prawa zastrzeżone.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdhMIiqetOfDGP85ERxtgwn3AXR50pBcE",
      authDomain: "base-468e0.firebaseapp.com",
      projectId: "base-468e0",
      storageBucket: "base-468e0.firebasestorage.app",
      messagingSenderId: "829161895559",
      appId: "1:829161895559:web:d832541aac05b35847ea22"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.collection = collection;
    window.getDocs = getDocs;
  </script>

  <!-- Google Maps + MarkerClusterer -->
  <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

  <script>
    let map;
    let markers = [];
    let markerCluster;
    let allOffers = [];

    // Inicjalizacja mapy
    async function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 52.0, lng: 19.0 },
        zoom: 6,
        gestureHandling: "greedy",
        mapTypeId: google.maps.MapTypeId.HYBRID
      });

      google.maps.event.addListener(map, "idle", () => {
        filterOffersByBounds();
      });

      await loadOffers();
      
      // Obsługa scrollowania na mapie
      const mapContainer = document.getElementById('map');
      mapContainer.addEventListener('wheel', function(e) {
        if (e.target.closest('.gm-style')) {
          e.preventDefault();
          const delta = e.deltaY || e.detail || (-e.wheelDelta);
          const currentZoom = map.getZoom();
          if (delta < 0) {
            map.setZoom(currentZoom + 0.5);
          } else {
            map.setZoom(currentZoom - 0.5);
          }
        }
      }, { passive: false });
    }

    // Ładowanie ofert
    async function loadOffers() {
      try {
        const snapshot = await window.getDocs(window.collection(window.db, "propertyListings"));
        const listContainer = document.getElementById("offersList");
        listContainer.innerHTML = "";

        // Wyczyść poprzednie oferty i markery
        allOffers = [];
        markers.forEach(marker => marker.setMap(null));
        markers = [];

        // Obiekt do przechowywania polygonów
        const plotPolygons = [];

        snapshot.forEach(doc => {
          const data = doc.data();
          if (!data.plots || data.plots.length === 0) return;

          data.plots.forEach((plot, index) => {
            // Filtruj tylko oferty z mock: true
            if (!plot.mock) return;
            
            const lat = plot.lat;
            const lng = plot.lng;
            const geometry = plot.geometry_uldk;

            // marker
            const marker = new google.maps.Marker({
              position: { lat, lng },
              map,
              title: data.firstName || "Oferta",
              icon: {
                url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png"
              }
            });
            markers.push(marker);

            // Dodaj klikalność do markera
            marker.addListener('click', () => {
              const infoWindow = new google.maps.InfoWindow({
                content: `
                  <div class="map-info-window">
                    <h3>${plot.Id || "Brak identyfikatora"}</h3>
                    <p><b>Miejscowość:</b> ${data.city || "brak"}</p>
                    <p><b>Cena:</b> ${plot.price || "brak"} zł</p>
                    <p><b>Powierzchnia:</b> ${plot.pow_dzialki_m2_uldk ? plot.pow_dzialki_m2_uldk.toFixed(2) + " m²" : "brak"}</p>
                    <p><b>Telefon:</b> ${data.phone || "brak"}</p>
                  </div>
                `
              });
              infoWindow.open(map, marker);
              
              // Dodaj to, aby zamknąć poprzednie okno informacyjne
              google.maps.event.addListener(infoWindow, 'closeclick', () => {
                infoWindow.setMap(null);
              });
            });

            let polygon = null;
            // Parsowanie geometrii i tworzenie polygonu (ukrytego początkowo)
            if (geometry) {
              const coords = parseGeometry(geometry);
              if (coords.length > 0) {
                polygon = new google.maps.Polygon({
                  paths: coords,
                  strokeColor: "#FF0000", // Czerwony kolor
                  strokeOpacity: 0.8,
                  strokeWeight: 3,        // Grubsza linia
                  fillColor: "#FF0000",   // Czerwone wypełnienie
                  fillOpacity: 0.15,      // Przezroczyste wypełnienie
                  map: null, // Początkowo nie pokazujemy na mapie
                  visible: false
                });
                
                // Dodaj klikalność do polygonu
                polygon.addListener('click', (event) => {
                  new google.maps.InfoWindow({
                    content: `
                      <div class="map-info-window">
                        <h3>${plot.Id || "Brak identyfikatora"}</h3>
                        <p><b>Miejscowość:</b> ${data.city || "brak"}</p>
                        <p><b>Cena:</b> ${plot.price || "brak"} zł</p>
                        <p><b>Powierzchnia:</b> ${plot.pow_dzialki_m2_uldk ? plot.pow_dzialki_m2_uldk.toFixed(2) + " m²" : "brak"}</p>
                        <p><b>Telefon:</b> ${data.phone || "brak"}</p>
                      </div>
                    `,
                    position: event.latLng
                  }).open(map);
                });
                
                plotPolygons.push({
                  polygon: polygon,
                  bounds: getPolygonBounds(coords),
                  marker: marker
                });
              }
            }

            // Zapisz ofertę w globalnej tablicy
            allOffers.push({
              id: doc.id,
              data: data,
              plot: plot,
              index: index,
              marker: marker,
              polygon: polygon || null
            });
          });
        });

        // klastrowanie markerów
        if (markerCluster) {
          markerCluster.clearMarkers();
        }
        markerCluster = new markerClusterer.MarkerClusterer({
          map,
          markers,
          renderer: {
            render: ({ count, position }) => {
              return new google.maps.Marker({
                position,
                label: {
                  text: String(count),
                  color: "white",
                  fontSize: "14px",
                  fontWeight: "bold"
                },
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 20,        // wielkość
                  fillColor: "red", // czerwony kolor
                  fillOpacity: 0.8,
                  strokeColor: "red",
                  strokeWeight: 2
                }
              });
            }
          }
        });

        // Obsługa zmiany zoomu - pokaż/ukryj polygony
        google.maps.event.addListener(map, 'zoom_changed', () => {
          const zoom = map.getZoom();
          const showPolygons = zoom >= 8; // Pokazuj polygony przy zoom >= 12
          
          plotPolygons.forEach(plot => {
            if (showPolygons && plot.polygon) {
              plot.polygon.setMap(map);
              plot.polygon.setVisible(true);
            } else if (plot.polygon) {
              plot.polygon.setMap(null);
              plot.polygon.setVisible(false);
            }
          });
        });

        // Po załadowaniu ofert, przefiltruj je
        filterOffersByBounds();

      } catch (err) {
        console.error("Błąd pobierania ofert:", err);
      }
    }

    // Funkcja do filtrowania ofert widocznych na mapie
    function filterOffersByBounds() {
      if (!map || !allOffers.length) {
        console.log("Mapa nie jest gotowa lub brak ofert");
        return;
      }
      
      const bounds = map.getBounds();
      if (!bounds) {
        console.log("Bounds nie są dostępne");
        return;
      }
      
      const visibleOffers = allOffers.filter(offer => {
        return bounds.contains(offer.marker.getPosition());
      });
      
      // Wyświetl tylko widoczne oferty
      const listContainer = document.getElementById("offersList");
      if (!listContainer) {
        console.log("Element offersList nie istnieje");
        return;
      }
      
      listContainer.innerHTML = "";
      
      if (visibleOffers.length === 0) {
        listContainer.innerHTML = '<p class="no-offers">Brak ofert w widocznym obszarze</p>';
        return;
      }
      
      visibleOffers.forEach(offer => {
        const card = document.createElement("div");
        card.className = "offer-card";
        
        // Oblicz cenę za m²
        const pricePerM2 = offer.plot.pow_dzialki_m2_uldk ? 
          (parseFloat(offer.plot.price) / offer.plot.pow_dzialki_m2_uldk).toFixed(2) : 
          "0.00";
          
        card.innerHTML = `
          <h5>${offer.plot.Id || "Brak identyfikatora"}</h5>
          ${offer.data.city ? `<p><b>Miejscowość:</b> ${offer.data.city}</p>` : ""}
          <p><b>Telefon:</b> ${offer.data.phone || "-"}</p>
          
          ${offer.plot.price ? `<p><b>Cena całkowita:</b> ${offer.plot.price} zł <span style="color: #888; font-size: 0.85em; margin-left: 5px;">${pricePerM2} zł/m²</span></p>` : ""}
          ${offer.plot.pow_dzialki_m2_uldk ? `<p><b>Powierzchnia:</b> ${offer.plot.pow_dzialki_m2_uldk.toFixed(2)} m²</p>` : ""}
        `;
        
        // Dodaj obsługę kliknięcia
        card.addEventListener("click", () => {
          map.panTo(offer.marker.getPosition());
          map.setZoom(15);
          
          // Sprawdź czy klikamy tę samą ofertę
          if (window.currentInfoWindow && window.currentInfoWindowOffer === offer.marker) {
            window.currentInfoWindow.close();
            window.currentInfoWindow = null;
            window.currentInfoWindowOffer = null;
            return;
          }
          
          // Zamknij poprzednie okno jeśli istnieje
          if (window.currentInfoWindow) {
            window.currentInfoWindow.close();
          }
          
          // Stwórz i otwórz nowe okno informacyjne
          window.currentInfoWindow = new google.maps.InfoWindow({
            content: `
              <div class="map-info-window">
                <h3>${offer.plot.Id || "Brak identyfikatora"}</h3>
                <p><b>Miejscowość:</b> ${offer.data.city || "brak"}</p>
                <p><b>Cena:</b> ${offer.plot.price || "brak"} zł</p>
                <p><b>Powierzchnia:</b> ${offer.plot.pow_dzialki_m2_uldk ? offer.plot.pow_dzialki_m2_uldk.toFixed(2) + " m²" : "brak"}</p>
                <p><b>Telefon:</b> ${offer.data.phone || "brak"}</p>
              </div>
            `
          });
          
          window.currentInfoWindowOffer = offer.marker;
          window.currentInfoWindow.open(map, offer.marker);
        });
        
        listContainer.appendChild(card);
      });
    }

    // Funkcja pomocnicza do parsowania geometrii z konwersją EPSG:2180 -> WGS84
    function parseGeometry(geometryString) {
      const coords = [];
      try {
        console.log("Parsowanie geometrii:", geometryString);
        
        // Definicja układu współrzędnych EPSG:2180 (PL-1992)
        proj4.defs("EPSG:2180", "+proj=tmerc +lat_0=0 +lon_0=19 +k=0.9993 +x_0=500000 +y_0=-5300000 +ellps=GRS80 +units=m +no_defs");
        
        // Parsowanie stringa POLYGON((...))
        const coordString = geometryString.match(/\(\(([^)]+)\)\)/)[1];
        const points = coordString.split(',');
        
        points.forEach(point => {
          const parts = point.trim().split(' ');
          const x = parseFloat(parts[0]); // współrzędna X w EPSG:2180
          const y = parseFloat(parts[1]); // współrzędna Y w EPSG:2180
          
          // Konwersja z EPSG:2180 do WGS84
          const wgs84Coords = proj4("EPSG:2180", "WGS84", [x, y]);
          
          console.log("Point:", point, "->", {lat: wgs84Coords[1], lng: wgs84Coords[0]});
          
          coords.push({ 
            lat: wgs84Coords[1], // latitude
            lng: wgs84Coords[0]  // longitude
          });
        });
      } catch (e) {
        console.error("Błąd parsowania geometrii:", e, geometryString);
      }
      
      console.log("Wygenerowane współrzędne:", coords);
      return coords;
    }

    // Funkcja do obliczania bounds dla polygonu
    function getPolygonBounds(coords) {
      const bounds = new google.maps.LatLngBounds();
      coords.forEach(coord => {
        bounds.extend(coord);
      });
      return bounds;
    }

    function loadGoogleMaps() {
      const apiKey = localStorage.getItem('googleMapsApiKey') || 'AIzaSyCr5TmFxnT3enxmyr6vujF8leP995giw8I';
      const script = document.createElement("script");
      script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    }

    document.addEventListener("DOMContentLoaded", loadGoogleMaps);
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics.js";
    import { 
      getAuth, 
      createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged,
      GoogleAuthProvider,
      FacebookAuthProvider,
      signInWithPopup,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      query, 
      where, 
      getDocs, 
      doc, 
      setDoc,
      getDoc,
      updateDoc,
      deleteDoc  
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBdhMIiqetOfDGP85ERxtgwn3AXR50pBcE",
      authDomain: "base-468e0.firebaseapp.com",
      projectId: "base-468e0",
      storageBucket: "base-468e0.firebasestorage.app",
      messagingSenderId: "829161895559",
      appId: "1:829161895559:web:d832541aac05b35847ea22"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // PROVIDERS
    const googleProvider = new GoogleAuthProvider();
    const facebookProvider = new FacebookAuthProvider();

    // DOM Elements
    const authButtons = document.getElementById('authButtons');
    const userMenu = document.getElementById('userMenu');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const accountBtn = document.getElementById('accountBtn');
    const addOfferBtn = document.getElementById('addOfferBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginModal = document.getElementById('loginModal');
    const registerModal = document.getElementById('registerModal');
    const closeModalButtons = document.querySelectorAll('.modal-close');
    const switchToRegister = document.getElementById('switchToRegister');
    const switchToLogin = document.getElementById('switchToLogin');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const userDashboard = document.getElementById('userDashboard');
    const userOffers = document.getElementById('userOffers');
    const heroAddOffer = document.getElementById('heroAddOffer');
    const dashboardAddOffer = document.getElementById('dashboardAddOffer');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const facebookLoginBtn = document.getElementById('facebookLoginBtn');
    const domainWarning = document.getElementById('domainWarning');

    // Check if we're on an authorized domain
    function checkAuthorizedDomain() {
      const currentDomain = window.location.hostname;
      const authorizedDomains = [
        'https://trainingtwenty5.github.io/dzialkofert/'
      ];
      
      // Add your custom domain here once you configure it in Firebase
      // authorizedDomains.push('twojadomena.pl');
      
      if (!authorizedDomains.includes(currentDomain)) {
        domainWarning.style.display = 'block';
        console.warn('Uwaga: Obecna domena nie jest autoryzowana w Firebase. Logowanie przez Facebook może nie działać.');
      }
    }

    // Check auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User is signed in
        authButtons.style.display = 'none';
        userMenu.style.display = 'flex';
        accountBtn.innerHTML = `<i class="fas fa-user me-1"></i> ${user.displayName || user.email}`;
        userDashboard.style.display = 'block';
        loadUserOffers(user.email);
        
        // Automatycznie zamknij modale po zalogowaniu
        closeModal(loginModal);
        closeModal(registerModal);
      } else {
        // User is signed out
        authButtons.style.display = 'flex';
        userMenu.style.display = 'none';
        userDashboard.style.display = 'none';
      }
    });

    // Open modals
    loginBtn.addEventListener('click', () => openModal(loginModal));
    registerBtn.addEventListener('click', () => {
      openModal(registerModal);
      checkAuthorizedDomain(); // Sprawdź domenę przy rejestracji
    });
    switchToRegister.addEventListener('click', (e) => {
      e.preventDefault();
      closeModal(loginModal);
      openModal(registerModal);
      checkAuthorizedDomain(); // Sprawdź domenę przy rejestracji
    });
    switchToLogin.addEventListener('click', (e) => {
      e.preventDefault();
      closeModal(registerModal);
      openModal(loginModal);
    });

    // Close modals
    closeModalButtons.forEach(button => {
      button.addEventListener('click', () => {
        const modal = button.closest('.modal');
        closeModal(modal);
      });
    });

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        closeModal(e.target);
      }
    });

    // Login form
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
        console.log('User logged in successfully');
      } catch (error) {
        alert('Błąd logowania: ' + error.message);
      }
    });

    // Register form
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;

      if (password !== confirmPassword) {
        alert('Hasła nie są identyczne!');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Update profile with name
        await updateProfile(user, { displayName: name });
        
        // Create user profile in Firestore
        await setDoc(doc(db, "users", user.uid), {
          name: name,
          email: email,
          createdAt: new Date()
        });
        
        console.log('User registered successfully');
      } catch (error) {
        alert('Błąd rejestracji: ' + error.message);
      }
    });

    // Google login
    googleLoginBtn.addEventListener('click', async () => {
      try {
        const result = await signInWithPopup(auth, googleProvider);
        const user = result.user;
        
        // Check if user exists in Firestore, if not create a record
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (!userDoc.exists()) {
          await setDoc(doc(db, "users", user.uid), {
            name: user.displayName,
            email: user.email,
            createdAt: new Date(),
            provider: "google"
          });
        }
        
        console.log('Zalogowano przez Google:', user);
      } catch (error) {
        console.error("Błąd logowania przez Google:", error);
        alert('Błąd logowania przez Google: ' + error.message);
      }
    });

    // Facebook login with error handling for unauthorized domain
    facebookLoginBtn.addEventListener('click', async () => {
      try {
        const result = await signInWithPopup(auth, facebookProvider);
        const user = result.user;
        
        // Check if user exists in Firestore, if not create a record
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (!userDoc.exists()) {
          await setDoc(doc(db, "users", user.uid), {
            name: user.displayName,
            email: user.email,
            createdAt: new Date(),
            provider: "facebook"
          });
        }
        
        console.log('Zalogowano przez Facebook:', user);
      } catch (error) {
        console.error("Błąd logowania przez Facebook:", error);
        
        if (error.code === 'auth/unauthorized-domain') {
          alert('Logowanie przez Facebook nie jest dostępne na tej domenie. Skontaktuj się z administratorem, aby dodać domenę do konfiguracji Firebase.');
        } else {
          alert('Błąd logowania przez Facebook: ' + error.message);
        }
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      signOut(auth);
    });

    // Account button
    accountBtn.addEventListener('click', () => {
      userDashboard.scrollIntoView({ behavior: 'smooth' });
    });

    // Modal functions
    function openModal(modal) {
      modal.style.display = 'flex';
    }

    function closeModal(modal) {
      modal.style.display = 'none';
      // Reset form fields when closing modal
      if (modal === loginModal) {
        loginForm.reset();
      } else if (modal === registerModal) {
        registerForm.reset();
      }
    }

    // Funkcja do usuwania (dezaktywacji) oferty
    async function deleteOffer(offerId, offerTitle) {
      if (!confirm(`Czy na pewno chcesz usunąć ofertę "${offerTitle}"?`)) {
        return;
      }
      
      try {
        // Zmień wartość mock na false (dezaktywacja)
        await updateDoc(doc(db, "propertyListings", offerId), {
          mock: false
        });
        
        alert("Oferta została usunięta!");
        // Odśwież listę ofert
        const user = auth.currentUser;
        if (user) {
          loadUserOffers(user.email);
        }
      } catch (error) {
        console.error("Błąd podczas usuwania oferty:", error);
        alert("Wystąpił błąd podczas usuwania oferty.");
      }
    }

    // POPRAWIONA funkcja loadUserOffers - wyświetla każdą działkę jako osobny kafelek
    async function loadUserOffers(email) {
      try {
        const q = query(collection(db, "propertyListings"), where("email", "==", email));
        const querySnapshot = await getDocs(q);
        
        userOffers.innerHTML = '';
        
        if (querySnapshot.empty) {
          userOffers.innerHTML = '<p>Nie masz jeszcze żadnych ofert.</p>';
          return;
        }
        
        querySnapshot.forEach((doc) => {
          const offer = doc.data();
          const offerId = doc.id;
          
          // Sprawdź czy oferta ma działki
          if (!offer.plots || offer.plots.length === 0) return;
          
          // Znajdź oryginalne indeksy aktywnych działek
          const activePlotsWithIndex = offer.plots
            .map((plot, originalIndex) => ({ plot, originalIndex }))
            .filter(({ plot }) => {
              // Jeśli pole mock nie istnieje, traktuj jako aktywne
              if (plot.mock === undefined) return true;
              return plot.mock !== false;
            });
          
          if (activePlotsWithIndex.length === 0) return; // Pomiń oferty bez aktywnych działek
          
          // Dla każdej aktywnej działki utwórz kartę
          activePlotsWithIndex.forEach(({ plot, originalIndex }, displayIndex) => {
            const offerElement = document.createElement('div');
            offerElement.classList.add('offer-card');
            
            // Oblicz cenę za m²
            const pricePerM2 = plot.pow_dzialki_m2_uldk ? 
              (parseFloat(plot.price) / plot.pow_dzialki_m2_uldk).toFixed(2) : 
              "0.00";
              
            // Użyj nazwy działki jako tytułu
            const plotTitle = plot.Id || `Działka ${displayIndex + 1}`;
              
            offerElement.innerHTML = `
              <h3 class="offer-title">${plotTitle}</h3>
              <div class="offer-details">
                <p><strong>Lokalizacja:</strong> ${offer.city || 'Nie podano'}</p>
                <p><strong>Telefon:</strong> ${offer.phone || 'Nie podano'}</p>
                <p><strong>Powierzchnia:</strong> ${plot.pow_dzialki_m2_uldk ? plot.pow_dzialki_m2_uldk.toFixed(2) : 'Nie podano'} m²</p>
                <p><strong>Cena całkowita:</strong> ${plot.price || 'Nie podano'} zł <span style="color: #888; font-size: 0.85em; margin-left: 5px;">${pricePerM2} zł/m²</span></p>
              </div>
              <div class="offer-actions">
                <button class="btn btn-primary btn-sm" onclick="editOffer('${offerId}', ${originalIndex})">
                  <i class="fas fa-edit"></i> Edytuj
                </button>
                <button class="btn btn-secondary btn-sm" onclick="deletePlot('${offerId}', ${originalIndex}, '${plotTitle}')">
                  <i class="fas fa-trash"></i> Usuń
                </button>
              </div>
            `;
            userOffers.appendChild(offerElement);
          });
        });
        
        // Sprawdź czy są jakieś aktywne oferty
        if (userOffers.innerHTML === '') {
          userOffers.innerHTML = '<p>Nie masz jeszcze żadnych aktywnych ofert.</p>';
        }
      } catch (error) {
        console.error("Error loading offers: ", error);
        userOffers.innerHTML = '<p>Wystąpił błąd podczas ładowania ofert.</p>';
      }
    }

    // Przenieś te funkcje do globalnego zakresu
    window.editOffer = async function(offerId, plotIndex) {
      try {
        // Przekieruj do strony edycji z parametrami
        window.location.href = `dodaj.html?edit=${offerId}&plot=${plotIndex}`;
      } catch (error) {
        console.error("Błąd podczas edycji oferty:", error);
        alert("Wystąpił błąd podczas edycji oferty.");
      }
    }

    window.deletePlot = async function(offerId, plotIndex, plotTitle) {
      if (!confirm(`Czy na pewno chcesz usunąć ofertę "${plotTitle}"?`)) {
        return;
      }
      
      try {
        console.log("Usuwanie oferty:", offerId, "Index:", plotIndex);
        
        // Pobierz aktualne dane oferty
        const offerDoc = await getDoc(doc(db, "propertyListings", offerId));
        if (!offerDoc.exists()) {
          alert("Oferta nie istnieje!");
          return;
        }
        
        const offerData = offerDoc.data();
        
        // Sprawdź czy oferta ma działki i czy index jest poprawny
        if (!offerData.plots || plotIndex >= offerData.plots.length) {
          alert("Działka nie istnieje!");
          return;
        }
        
        console.log("Aktualne dane przed usunięciem:", offerData.plots);
        
        // Utwórz kopię tablicy plots i oznacz konkretną działkę jako nieaktywną
        const updatedPlots = [...offerData.plots];
        updatedPlots[plotIndex] = {
          ...updatedPlots[plotIndex],
          mock: false
        };
        
        console.log("Dane po oznaczeniu jako nieaktywne:", updatedPlots);
        
        // ZAWSZE tylko aktualizuj tablicę plots, NIGDY nie usuwaj całego dokumentu
        await updateDoc(doc(db, "propertyListings", offerId), {
          plots: updatedPlots
        });
        
        alert("Oferta została usunięta!");
        
        // Odśwież listę ofert
        const user = auth.currentUser;
        if (user) {
          loadUserOffers(user.email);
        }
      } catch (error) {
        console.error("Błąd podczas usuwania oferty:", error);
        alert("Wystąpił błąd podczas usuwania oferty: " + error.message);
      }
    }

document.addEventListener('DOMContentLoaded', function() {
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  const navMenu = document.querySelector('.nav-menu');
  const mobileAuth = document.querySelector('.mobile-auth');
  
  mobileMenuBtn.addEventListener('click', function() {
    navMenu.classList.toggle('active');
    mobileAuth.style.display = navMenu.classList.contains('active') ? 'flex' : 'none';
  });
  
  // Obsługa kliknięcia w linki logowania/rejestracji
  document.getElementById('loginLink')?.addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('loginModal').style.display = 'flex';
    navMenu.classList.remove('active');
  });
  
  document.getElementById('registerLink')?.addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('registerModal').style.display = 'flex';
    navMenu.classList.remove('active');
  });
});


// Skrypt zapobiegający problemom z responsywnością
let resizeTimer;
window.addEventListener('resize', () => {
  document.body.classList.add('resize-animation-stopper');
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    document.body.classList.remove('resize-animation-stopper');
    // Wymuszenie ponownego renderowania menu
    const navMenu = document.querySelector('.nav-menu');
    if (window.innerWidth > 768) {
      navMenu.classList.remove('active');
    }
  }, 400);
});

    
    // FAQ accordion
    const faqItems = document.querySelectorAll('.faq-item');
    
    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question');
      
      question.addEventListener('click', () => {
        item.classList.toggle('active');
      });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetId = this.getAttribute('href');
        if (targetId === '#') return;
        
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          window.scrollTo({
            top: targetElement.offsetTop - 80,
            behavior: 'smooth'
          });
          
          // Close mobile menu if open
          if (navMenu.classList.contains('active')) {
            navMenu.classList.remove('active');
            mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
          }
        }
      });
    });
	
	
	
	

  // === DOPISZ DO PIERWSZEGO PLIKU (po Twoim kodzie mobile-menu) ===
  const mobileAuth = document.querySelector('.mobile-auth');
  const loginLink  = document.getElementById('loginLink');
  const registerLink = document.getElementById('registerLink');

  // Pokaż/ukryj logowanie w mobilnym menu
  function refreshMobileAuthVisibility() {
    const isMenuOpen = navMenu.classList.contains('active');
    // jeśli zalogowany -> nie pokazuj; jeśli wylogowany i menu otwarte -> pokaż
    const user = (typeof auth !== 'undefined') ? auth.currentUser : null;
    if (window.innerWidth <= 768) {
      mobileAuth.style.display = (isMenuOpen && !user) ? 'flex' : 'none';
    } else {
      mobileAuth.style.display = 'none';
    }
  }

  // przy otwieraniu/zamykaniu menu
  mobileMenuBtn.addEventListener('click', refreshMobileAuthVisibility);
  window.addEventListener('resize', refreshMobileAuthVisibility);

  // klik w linki otwiera odpowiednie modale
  loginLink?.addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('loginModal').style.display = 'flex';
    navMenu.classList.remove('active');
    refreshMobileAuthVisibility();
    mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
  });

  registerLink?.addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('registerModal').style.display = 'flex';
    navMenu.classList.remove('active');
    refreshMobileAuthVisibility();
    mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
  });

  // po zmianie stanu logowania odświeżaj widoczność
  if (typeof onAuthStateChanged === 'function' && typeof auth !== 'undefined') {
    onAuthStateChanged(auth, () => {
      refreshMobileAuthVisibility();
    });
  }


  </script>
  
  
 
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth, onAuthStateChanged,
    signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile,
    GoogleAuthProvider, signInWithPopup, signInWithRedirect,
    setPersistence, browserLocalPersistence, browserSessionPersistence, inMemoryPersistence
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore, collection, query, where, getDocs, doc, setDoc
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // --- Konfiguracja (ta sama) ---
  const firebaseConfig = {
    apiKey: "AIzaSyBdhMIiqetOfDGP85ERxtgwn3AXR50pBcE",
    authDomain: "base-468e0.firebaseapp.com",
    projectId: "base-468e0",
    storageBucket: "base-468e0.firebasestorage.app",
    messagingSenderId: "829161895559",
    appId: "1:829161895559:web:d832541aac05b35847ea22"
  };

  // --- Init ---
  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);
  auth.languageCode = 'pl';

  // 0) Ostrzeżenie o uruchamianiu z file://
  // if (location.protocol === 'file:') {
  //   alert('Uruchom stronę przez http/https (np. http://localhost), nie z pliku (file://). Inaczej logowanie nie zadziała.');
 //  }

  // 1) Persystencja (fallback kaskadowy)
  async function useBestPersistence() {
    try { await setPersistence(auth, browserLocalPersistence); }
    catch { try { await setPersistence(auth, browserSessionPersistence); }
    catch { await setPersistence(auth, inMemoryPersistence); } }
  }
  await useBestPersistence();

  // 2) Szybka podpowiedź o domenie (UI tylko informacyjne)
  (function domainHint(){
    const hint = document.getElementById('domainWarning');
    if (!hint) return;
    const knownGood = ['localhost','127.0.0.1','trainingtwenty5.github.io'];
    if (!knownGood.includes(location.hostname)) {
      hint.style.display = 'block';
      // Pamiętaj też dodać tę domenę w Firebase → Authorized domains
    }
  })();

  // 3) Provider Google
  const googleProvider = new GoogleAuthProvider();
  googleProvider.setCustomParameters({ prompt: 'select_account' });

  // 4) DOM
  const authButtons   = document.getElementById('authButtons');
  const userMenu      = document.getElementById('userMenu');
  const loginBtn      = document.getElementById('loginBtn');
  const registerBtn   = document.getElementById('registerBtn');
  const accountBtn    = document.getElementById('accountBtn');
  const logoutBtn     = document.getElementById('logoutBtn');
  const loginModal    = document.getElementById('loginModal');
  const registerModal = document.getElementById('registerModal');
  const closeBtns     = document.querySelectorAll('.modal-close');
  const switchToReg   = document.getElementById('switchToRegister');
  const switchToLog   = document.getElementById('switchToLogin');
  const loginForm     = document.getElementById('loginForm');
  const registerForm  = document.getElementById('registerForm');
  const userDashboard = document.getElementById('userDashboard');
  const userOffers    = document.getElementById('userOffers');
  const gBtn1         = document.getElementById('googleLoginBtn');
  const gBtn2         = document.getElementById('googleLoginBtnLogin');

  const openModal  = (m) => m && (m.style.display = 'flex');
  const closeModal = (m) => m && (m.style.display = 'none');

  // 5) Auth state
  onAuthStateChanged(auth, (user) => {
    if (user) {
      authButtons && (authButtons.style.display = 'none');
      userMenu    && (userMenu.style.display = 'flex');
      if (accountBtn) {
        const label = user.displayName ? user.displayName.split(' ')[0] : (user.email || 'Moje konto');
        accountBtn.innerHTML = `<i class="fas fa-user me-1"></i> ${label}`;
      }
      userDashboard && (userDashboard.style.display = 'block');
      user?.email && loadUserOffers(user.email);
      closeModal(loginModal); closeModal(registerModal);
    } else {
      authButtons && (authButtons.style.display = 'flex');
      userMenu    && (userMenu.style.display = 'none');
      userDashboard && (userDashboard.style.display = 'none');
      userOffers && (userOffers.innerHTML = '');
    }
  });

  // 6) UI zdarzenia
  loginBtn     && loginBtn.addEventListener('click', () => openModal(loginModal));
  registerBtn  && registerBtn.addEventListener('click', () => openModal(registerModal));
  switchToReg  && switchToReg.addEventListener('click', (e) => { e.preventDefault(); closeModal(loginModal);  openModal(registerModal); });
  switchToLog  && switchToLog.addEventListener('click', (e) => { e.preventDefault(); closeModal(registerModal); openModal(loginModal); });
  closeBtns?.forEach(b => b.addEventListener('click', () => closeModal(b.closest('.modal'))));
  window.addEventListener('click', (e) => { if (e.target.classList?.contains('modal')) closeModal(e.target); });
  accountBtn && accountBtn.addEventListener('click', () => document.getElementById('userDashboard')?.scrollIntoView({behavior:'smooth'}));

  // 7) Mapowanie błędów → PL
  const niceAuthError = (err) => {
    const code = err?.code || '';
    switch (code) {
      case 'auth/invalid-email':             return 'Nieprawidłowy adres e-mail.';
      case 'auth/missing-password':          return 'Podaj hasło.';
      case 'auth/invalid-credential':        return 'Nieprawidłowy e-mail lub hasło.';
      case 'auth/user-not-found':            return 'Użytkownik nie istnieje.';
      case 'auth/wrong-password':            return 'Błędne hasło.';
      case 'auth/too-many-requests':         return 'Za dużo prób. Spróbuj później.';
      case 'auth/unauthorized-domain':       return `Domena ${location.hostname} nie jest autoryzowana w Firebase (Authentication → Authorized domains).`;
      case 'auth/popup-blocked':             return 'Przeglądarka zablokowała okno logowania Google. Użyj przekierowania.';
      case 'auth/operation-not-supported-in-this-environment':
                                             return 'To środowisko nie wspiera popup (np. file://). Uruchom przez http/https.';
      default: return `Błąd: ${code || (err?.message || 'nieznany')}`;
    }
  };

  // 8) Email / hasło
  loginForm && loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const pass  = document.getElementById('loginPassword').value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      console.error('[login]', err);
      alert(niceAuthError(err));
    }
  });

  registerForm && registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const pass1 = document.getElementById('registerPassword').value;
    const pass2 = document.getElementById('registerConfirmPassword').value;
    if (pass1 !== pass2) return alert('Hasła nie są identyczne!');
    try {
      const { user } = await createUserWithEmailAndPassword(auth, email, pass1);
      if (name) await updateProfile(user, { displayName: name });
      await setDoc(doc(db, "users", user.uid), { name: name || null, email, createdAt: new Date(), provider: "password" }, { merge: true });
    } catch (err) {
      console.error('[register]', err);
      alert(niceAuthError(err));
    }
  });

  // 9) Google
  async function signInWithGoogleSmart() {
    const ok = ['http:', 'https:'].includes(location.protocol);
    if (!ok) return alert('Uruchom stronę przez http/https (nie file://).');
    try {
      await signInWithPopup(auth, googleProvider);
      closeModal(loginModal); closeModal(registerModal);
    } catch (err) {
      console.error('[google]', err);
      if (err?.code === 'auth/popup-blocked' || err?.code === 'auth/operation-not-supported-in-this-environment') {
        await signInWithRedirect(auth, googleProvider);
      } else {
        alert(niceAuthError(err));
      }
    }
  }
  [gBtn1, gBtn2].forEach(b => b && b.addEventListener('click', (e) => { e.preventDefault(); signInWithGoogleSmart(); }));

  // 10) Wylogowanie
  logoutBtn && logoutBtn.addEventListener('click', async () => { try { await auth.signOut(); } catch(e){} });

  // 11) Oferty (po e-mailu)
  async function loadUserOffers(email) {
    try {
      if (!userOffers) return;
      userOffers.innerHTML = '<p>Ładuję Twoje oferty…</p>';
      const q = query(collection(db, "propertyListings"), where("email", "==", email));
      const snap = await getDocs(q);
      userOffers.innerHTML = '';
      if (snap.empty) { userOffers.innerHTML = '<p>Nie masz jeszcze żadnych ofert.</p>'; return; }

      snap.forEach((docu) => {
        const offer = docu.data();
        if (Array.isArray(offer.plots) && offer.plots.length) {
          offer.plots
            .map((plot, originalIndex) => ({ plot, originalIndex }))
            .filter(({ plot }) => plot.mock !== false)
            .forEach(({ plot, originalIndex }, i) => {
              const city = offer.city || offer.location?.city || 'Nie podano';
              const area = Number(plot.pow_dzialki_m2_uldk ?? plot.area ?? plot.areaM2 ?? 0);
              const price = Number(plot.price ?? 0);
              const ppm2  = price && area ? price / area : 0;
              const el = document.createElement('div');
              el.className = 'offer-card';
              el.innerHTML = `
                <h3 class="offer-title">${plot.Id || `Działka ${i+1}`}</h3>
                <div class="offer-details">
                  <p><strong>Lokalizacja:</strong> ${city}</p>
                  <p><strong>Cena całkowita:</strong> ${price ? price.toLocaleString('pl-PL') : 'Nie podano'} zł
                    ${price && area ? `<span style="color:#888;font-size:.85em;margin-left:5px;">${Math.round(ppm2).toLocaleString('pl-PL')} zł/m²</span>` : ''}</p>
                  <p><strong>Powierzchnia:</strong> ${area ? area.toLocaleString('pl-PL') : 'Nie podano'} m²</p>
                </div>
                <div class="offer-actions">
                  <button class="btn btn-primary btn-sm" onclick="window.location.href='dodaj.html?edit=${docu.id}&plot=${originalIndex}'">
                    <i class="fas fa-edit"></i> Edytuj
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="alert('Usuń/edytuj w dodaj.html (docId + index)');">
                    <i class="fas fa-trash"></i> Usuń
                  </button>
                </div>`;
              userOffers.appendChild(el);
            });
        } else {
          const city  = offer.city || offer.location?.city || offer.miejscowosc || offer.miasto || 'Nie podano';
          const price = Number(offer.price || offer.cena || offer.totalPrice || 0);
          const area  = Number(offer.areaM2 || offer.powierzchnia || offer.pow_dzialki_m2__c || 0);
          const ppm2  = price && area ? Math.round(price / area) : 0;
          const el = document.createElement('div');
          el.className = 'offer-card';
          el.innerHTML = `
            <h3 class="offer-title">${city}</h3>
            <div class="offer-details">
              <p><strong>Lokalizacja:</strong> ${city}</p>
              <p><strong>Cena:</strong> ${price ? price.toLocaleString('pl-PL') : 'Nie podano'} zł
                ${price && area ? `<span style="color:#888;font-size:.85em;margin-left:5px;">${ppm2.toLocaleString('pl-PL')} zł/m²</span>` : ''}</p>
              <p><strong>Powierzchnia:</strong> ${area ? area.toLocaleString('pl-PL') : 'Nie podano'} m²</p>
            </div>`;
          userOffers.appendChild(el);
        }
      });
    } catch (err) {
      console.error('Error loading offers:', err);
      userOffers.innerHTML = '<p>Wystąpił błąd podczas ładowania ofert.</p>';
    }
  }
</script>
</body>
</html>